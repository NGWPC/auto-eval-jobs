id: metrics_calculator
description: Computes validation metrics (e.g., CSI, POD, FAR) from a raster agreement map and saves them to a JSON file. Assumes specific pixel values represent agreement categories based on the preceding agreement step.
outputTransmission:
  - value
  - reference

arguments:
  chunk_size:
    title: Chunk Size for Processing
    description: Chunk size for processing large rasters. Affects memory usage during raster loading and processing.
    schema:
      type: integer
      default: 1024
      minimum: 256
      maximum: 4096

inputs:
  agreement_map_path:
    title: Raster Agreement Map Path
    description: Path/URI to the input raster agreement map (GeoTIFF). Pixel values should encode agreement results with encoding 0=TN, 1=FN, 2=FP, 3=TP, 4=Masked, 255=NoData.
    required: true
    schema:
      type: string
      format: uri
      contentMediaType: image/tiff; application=geotiff

outputs:
  metrics_path:
    title: Metrics Output Path
    description: |
      Path/URI where the calculated validation metrics will be saved as a CSV file.
      The CSV file will contain categorical performance metrics derived from the agreement map:
      - Critical Success Index (CSI)
      - Probability of Detection (POD/Recall)
      - False Alarm Ratio (FAR)
      - Precision
      - F1 Score
      - And other gval categorical metrics
    schema:
      type: string
      format: uri
      contentMediaType: text/csv
